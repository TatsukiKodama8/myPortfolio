<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head'); %>
        <link rel="stylesheet" href="css/style.css" type="text/css">
        <link rel="icon" type="image/x-icon" href="../img/myFavicon.jpg">
</head>

<body>

    <header>
        <%- include('../partials/header'); %>
    </header>
    <main class="garally">
        <h1>GALLARY</h1>
    </main>

    <%# 画像の空の要素。この部分は動的に拡張される必要がある %>
        <div class="garally-container">
            <div class="radio">
                <input type="radio" id="radio10sec" name="secRadio" value="10" onchange="slideShow()" checked />
                <!-- checked => 初期値-->
                <label for="radio10sec">10 sec</label>

                <input type="radio" id="radio20sec" name="secRadio" value="20" onchange="slideShow()" />
                <label for="radio20sec">20 sec</label>

                <input type="radio" id="radio30sec" name="secRadio" value="30" onchange="slideShow()" />
                <label for="radio30sec">30 sec</label>
            </div>

            <img src="" class="pics" id="pics">
        </div>

        <footer>
            <%- include('../partials/footer'); %>
        </footer>

        <script>
            const imgArray = [
                'img/img_forest.jpg',
                'img/img_mountains.jpg',
                'img/img_snow.jpg',
                'img/lights.jpg',
            ];

            let counter = 0;    // initialize
            let sec = 1000;
            let interval = 10 * sec;
            let intervalId; // To store the interval ID

            const change2NextImg = () => {
                let aryNum = imgArray.length;
                counter = (counter < (aryNum - 1)) ? ++counter : 0; // counter++ だと動かない
                document.getElementById("pics").src = imgArray[counter];
            };

            const startSlideShow = () => {
                let img = document.getElementById('pics');
                img.src = imgArray[counter];
                intervalId = setInterval(change2NextImg, interval);
            };

            // ラジオボタンがチェックしているvalueを返す
            // TODO: for文使わなくてもできるでしょ、これ
            const obtainRadioElement = (name) => {
                let elems = document.getElementsByName(name);
                for (let i = 0; i < elems.length; i++) {
                    if (elems[i].checked) {
                        console.log("obtainRadioElement", elems[i].value);
                        return elems[i].value;
                    }
                }
            }

            const slideShow = () => {
                console.log("changed!");
                let intervalTime = parseFloat(obtainRadioElement('secRadio')) * sec; // Multiply by 1000 to get milliseconds
                console.log(typeof intervalTime);
                console.log(intervalTime, "msec");

                // インターバルをリセット
                clearInterval(intervalId);

                // 新しくインターバルを割り当てる
                intervalId = setInterval(change2NextImg, intervalTime);
            }

            window.onload = () => {
                startSlideShow();
            };
        </script>


</body>

</html>